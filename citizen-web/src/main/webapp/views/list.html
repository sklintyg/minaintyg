<!-- Modal confirm dialog for archive -->
<div id="archive-confirmation-dialog" modal="archiveOpen" close="closeArchiveDialog(false)" options="dialogOpts" role="alertdialog" aria-hidden="{{!archiveOpen}}">
  <div class="modal-header">
    <button class="close" ng-click="closeArchiveDialog(false)" aria-label="{{messageService.getProperty('common.close')}}">Ã—</button>
    <h3 ng-focus="dialogfocus" tabindex="-1"><span message key="inbox.archivemodal.header"></span></h3>
  </div>
  <div class="modal-body">
    <p><span message key="inbox.archivemodal.text"></span></p>
  </div>
  <div class="modal-footer">
    <button id="archive-button" class="btn btn-success" ng-click="closeArchiveDialog(true)"><span message key="button.archive"></span></button>
    <button class="btn btn-link" ng-click="closeArchiveDialog(false)"><span message key="common.cancel"></span></button>
  </div>
</div>

<!-- View start -->
<h1 ng-focus="pagefocus" tabindex="0" xmlns="http://www.w3.org/1999/html">
  <span id="inboxHeader" message key="inbox.header"></span>
</h1>

<div class="row-fluid">
  <div class="span7">
    <p>
      <span message key="inbox.description"></span>
    </p>
  </div>
</div>
<div class="row-fluid">
  <div class="span12">
    <div ng-hide="doneLoading" style="text-align: center; padding: 20px;">
      <img aria-labelledby="loading-message" src="/img/ajax-loader.gif" style="text-align: center;" />
      <p id="loading-message" style="text-align: center; color: #64ABC0; margin-top: 20px;">
        <strong><span message key="label.certificatesloading"></span></strong>
      </p>
    </div>
    <div ng-show="doneLoading && (certificates | inboxfilter).length>0">
      <div id="certTable">
        <div ng-repeat="cert in certificates | inboxfilter" class="{{cert.status}}">
          <div class="certificate">
            <div class="row-fluid">
              <div class="span12">
                <div id="certificate-{{cert.id}}" class="cert">
                  <div class="cert-titlebar" ng-class="{'cert-cancelled': cert.cancelled}">
                    <a ng-show="!cert.cancelled" ng-click="sendSelected(cert)" ng-href="#"><img class="cert-icon" alt="" ng-src="/img/{{cert.type | lowercase}}.png" /></a>
                    <img ng-show="cert.cancelled" class="cert-icon" alt="" ng-src="/img/{{cert.type | lowercase}}.png" />
                    <div class="row-fluid">
                      <div class="span8">
                        <h2>
                          <a class="cert-title" ng-click="sendSelected(cert)" ng-show="!cert.cancelled" ng-href="#"> <span message key="certificatetypes.{{cert.type | lowercase}}.commonname"></span></a>
                          <span class="cert-title" ng-show="cert.cancelled"><span message key="certificatetypes.{{cert.type | lowercase}}.commonname"></span> (tillbakadraget)</span>
                        </h2>
                      </div>
                      <div class="span3 issue">
                        <span message key="listtable.headers.issued"></span> <span class="cert-titlebar-value">{{cert.sentDate | date:'longDate'}}</span>
                      </div>
                      <div class="span1 archive">
                        <a id="archiveCertificateBtn-{{cert.id}}" title="{{messageService.getProperty('button.alt.archive')}}" ng-click="openArchiveDialog(cert)">
                          <img alt="{{messageService.getProperty('button.alt.archive')}}" src="/img/archive-icon.gif" />
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class="cert-header">
                    <div class="row-fluid" ng-show="cert.cancelled">
                      <div class="span8 header-row">
                        <div class="alert alert-warning">
                          <span message key="inbox.revoked"></span>
                        </div>
                      </div>
                    </div>
                    <div class="row-fluid">
                      <div class="span8 header-row">
                        <h3 class="tag"><span message key="listtable.headers.issuedby"></span></h3> {{cert.careunitName}}
                      </div>
                      <div class="span3">
                        <h3 class="tag"><span message key="listtable.headers.certperiod"></span></h3> <span id="certificate-period-{{cert.id}}">{{cert.fromDate | date:'longDate'}}&ndash;{{cert.tomDate| date:'longDate'}}</span>
                      </div>
                      <div class="span1"></div>
                    </div>
                    <div class="row-fluid">
                      <div class="span8 header-row">
                        <h3 class="tag"><span message key="listtable.headers.latestEvent"></span></h3>
                        <div ng-show="cert.statuses.length>0">
                          {{cert.statuses[0].timestamp | date:'short'}}
                          <span message key="certificates.status.{{cert.statuses[0].type}}"></span>
                          <span ng-show="cert.statuses[0].type == 'SENT'" message key="certificates.target.{{cert.statuses[0].target}}"></span>
                          <div collapse="isCollapsed">
                            <div ng-repeat="status in cert.statuses" ng-switch on="$index > 0">
                              <div ng-switch-when="true">
                                {{status.timestamp | date:'short'}}
                                <span message key="certificates.status.{{status.type}}"></span>
                                <span ng-show="status.type == 'SENT'" message key="certificates.target.{{status.target}}"></span><br>
                              </div>
                            </div>
                          </div>
                          <p>
                            <button class="btn-link btn-link-link" ng-show="cert.statuses.length>1" href="#status" ng-click="isCollapsed = !isCollapsed"><span message key="label.status.{{ !isCollapsed }}"></span></button>
                          </p>
                        </div>
                        <span ng-show="cert.statuses.length==0">Ingen</span>
                      </div>
                      <div class="span3">
                        <button id="viewCertificateBtn-{{cert.id}}" class="btn btn-success" ng-show="!cert.cancelled" ng-disabled="cert.cancelled" ng-click="sendSelected(cert)"><span message key="button.show"></span></button>
                      </div>
                      <div class="span1"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            </div>
          <div class="table-bottom" ng-show="(certificates | inboxfilter).length>0"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row-fluid">
	<div id="noCerts" ng-show="doneLoading && (certificates | inboxfilter).length<1" class="alert alert-error">
		<span message key="error.nocerts"></span>
	</div>
</div>